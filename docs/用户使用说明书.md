# 数控车床生产管理系统 - 用户使用说明书

## 1. 系统概述

数控车床生产管理系统（订单管理助手）是一个基于二维码的任务分发和机床控制的自动化系统。该系统通过任务分发系统协调人、DNC软件和机床，实现自动化加工流程。系统强调GUI控制模拟人类输入，确保不影响人类操作。

## 2. 系统功能

### 2.1 主要功能
- 二维码任务输入：扫描二维码输入任务信息
- 任务调度管理：根据机床状态和材料兼容性自动分配任务
- 机床状态监控：通过onoff.txt文件实时监控机床状态
- UI自动化控制：模拟键盘/鼠标操作与DNC软件交互
- 材料管理：检查材料兼容性，提供库存管理

### 2.2 系统架构
```
人（操作员） ←→ 任务分发系统 ←→ DNC系统 ←→ DNC传输软件 ←→ 机床
                    ↓                    ↓
                onoff.txt            macro.txt
```

## 3. 系统安装与配置

### 3.1 环境要求
- 操作系统：Windows 7/8/10/11
- Python 3.8 或更高版本
- .NET Framework 4.8（如需要）
- 系统需要管理员权限运行

### 3.2 依赖安装
1. 安装Python 3.8+
2. 安装项目依赖：
   ```bash
   pip install -r requirements.txt
   ```

### 3.3 系统配置
1. 编辑`config.yaml`文件配置机床参数
2. 设置onoff.txt和macro.txt文件路径
3. 配置DNC系统窗口和控件参数

## 4. 系统启动

### 4.1 启动方式
1. 确保DNC系统已启动
2. 运行主程序：
   ```bash
   python main.py
   ```
3. 选择GUI或CLI界面

### 4.2 系统初始化
- 系统启动后自动加载配置
- 初始化各模块组件
- 启动文件监控服务
- 连接DNC系统

## 5. 日常操作流程

### 5.1 任务录入
1. **二维码扫描**
   - 使用扫描设备扫描指示书二维码
   - 系统自动解析任务信息
   - 验证材料兼容性

2. **手动录入**
   - 在系统界面输入指示书编号
   - 输入产品型号、材料规格、数量等信息
   - 设置任务优先级

### 5.2 任务调度
1. 系统自动根据以下条件分配任务：
   - 机床当前状态（空闲/运行）
   - 材料兼容性
   - 任务优先级
   - 机床能力匹配

2. 任务状态流转：
   - 待处理 → 就绪 → 运行中 → 完成

### 5.3 机床操作
1. **材料更换**
   - 系统提示材料不匹配
   - 操作员根据提示更换材料
   - 更新机床材料信息

2. **产品取出**
   - 加工完成后取出产品
   - 系统自动更新完成数量

### 5.4 状态监控
- 实时监控机床状态
- 查看任务进度
- 监控材料库存

## 6. 界面操作指南

### 6.1 主界面布局
```
+-------------------------+-------------------------------+
|     任务队列管理         |       机床状态监控            |
| +---------------------+ | +---------------------------+ |
| | CNC-01 [空闲]       | | | CNC-01: 空闲             | |
| |  ├─ JOB001 [就绪]   | | | CNC-02: 加工中           | |
| |  ├─ JOB002 [等待]   | | | CNC-03: 材料不匹配       | |
| |  └─ JOB003 [错误]   | | | CNC-04: 空闲             | |
| |                     | | | CNC-05: 维护中           | |
| | CNC-02 [加工中]     | | +---------------------------+ |
| |  └─ JOB004 [加工中] | |                               |
| +---------------------+ |       材料一致性检查           |
|                         | +---------------------------+ |
|     批量操作面板         | | 任务: JOB002             |   |
| +---------------------+ | | 材料: S45C               |  |
| | [启动选中任务]       | | | 机床材料: AL6061         |  |
| | [暂停队列]          | | | 状态: ❌ 不匹配          |  |
| | [重新排序]          | | | 建议: 更换材料或调整机床  |  |
| | [导出报告]          | | +---------------------------+ |
| +---------------------+ |                                |
+-------------------------+-------------------------------+
|                    系统日志                                  |
```

### 6.2 任务队列管理
- **添加任务**：点击"添加任务"按钮
- **删除任务**：选中任务后点击"删除"
- **修改优先级**：右键任务选择优先级
- **暂停/恢复**：控制任务执行状态

### 6.3 机床状态监控
- 状态指示：绿色（空闲）、蓝色（就绪）、红色（运行）
- 详细信息：双击机床查看详细状态
- 手动控制：可手动设置机床状态

## 7. 材料管理

### 7.1 材料映射表
- 位置：`config/material_mapping.csv`
- 包含：二维码文本、材料名称、规格、库存等信息

### 7.2 材料检查
- 自动检查任务材料与机床材料兼容性
- 提供材料更换建议
- 监控材料库存

### 7.3 材料库存更新
- 手动更新材料库存
- 自动扣减已使用材料
- 低库存预警

## 8. 系统配置

### 8.1 配置文件
- 主配置：`config.yaml`
- 文件路径配置
- 机床参数设置
- 自动化参数

### 8.2 CNC系统配置
```yaml
dnc_system:
  window_title: "DNC控制系统 V3.2"
  process_name: "DNCApp.exe"
  class_name: "WindowsForms10.Window.8.app.0.141b42a_r7_ad1"
  timeout: 30
  controls:
    main_input:
      - method: "auto_id"
        value: "txtModelInput"
    submit_button:
      - method: "auto_id"
        value: "btnSubmit"
```

### 8.3 文件路径配置
```yaml
file_monitoring:
  onoff_file: "C:/macro/onoff.txt"
  macro_file: "C:/macro/macro.txt"
  scan_interval: 1.0
```

## 9. 故障排除

### 9.1 常见问题
1. **无法连接DNC系统**
   - 检查DNC系统是否启动
   - 验证窗口标题和控件配置
   - 确认权限设置

2. **文件监控失败**
   - 检查onoff.txt和macro.txt路径
   - 确认文件读写权限
   - 验证文件格式

3. **任务分配失败**
   - 检查机床状态
   - 验证材料兼容性
   - 确认任务参数

### 9.2 日志查看
- 日志文件：`logs/system.log`
- 记录系统运行状态
- 故障信息追踪

## 10. 维护与备份

### 10.1 定期维护
- 定期清理日志文件
- 检查材料库存
- 验证配置文件

### 10.2 数据备份
- 任务数据备份
- 配置文件备份
- 材料映射表备份

## 11. 安全注意事项

1. **操作安全**
   - 确保机床安全状态下操作
   - 遵循机床操作规程
   - 材料更换时注意安全

2. **数据安全**
   - 定期备份重要数据
   - 保护配置文件
   - 防止未授权访问

## 12. 技术支持

- 系统架构：Python + PyQt6
- UI自动化：pywinauto + selenium
- 文件监控：watchdog
- 数据处理：pandas

如需技术支持，请联系系统管理员或参考相关技术文档。

---

**版本信息**：v1.0  
**最后更新**：2025年11月27日