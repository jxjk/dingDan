# æ•°æ§è½¦åºŠç”Ÿäº§ç®¡ç†ç³»ç»Ÿä¿®å¤ä¿®æ”¹æç¤º

## é—®é¢˜æ¦‚è¿°

æ ¹æ®æµ‹è¯•ç»“æœï¼Œç³»ç»Ÿå­˜åœ¨ä»¥ä¸‹ä¸»è¦é—®é¢˜ï¼š
1. ææ–™æ˜ å°„è¡¨åŠ è½½å¤±è´¥ï¼ˆ'äºŒç»´ç æ–‡æœ¬'åˆ—ç¼ºå¤±ï¼‰
2. é…ç½®éªŒè¯å¤±è´¥ï¼ˆé…ç½®ç»“æ„ä¸åŒ¹é…ï¼‰
3. æ–‡ä»¶ç›‘æ§è·¯å¾„ä¸æ­£ç¡®

## ä¿®å¤æ–¹æ¡ˆ

### 1. ææ–™æ˜ å°„è¡¨é—®é¢˜ä¿®å¤

**é—®é¢˜æè¿°ï¼š**
- ææ–™æ˜ å°„è¡¨åŠ è½½å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯ï¼š'äºŒç»´ç æ–‡æœ¬'
- ææ–™è®°å½•æ•°ä¸º0ï¼Œæ— æ³•æ‰¾åˆ°æµ‹è¯•ææ–™ï¼ˆS45Cã€AL6061ã€SS304ã€é»„é“œï¼‰

**ä¿®å¤æ–¹æ¡ˆï¼š**
å·²åˆ›å»º `services/material_mapper.py` æ–‡ä»¶ï¼ŒåŒ…å«å®Œæ•´çš„ææ–™æ˜ å°„è¡¨ç®¡ç†åŠŸèƒ½ï¼š
- è‡ªåŠ¨åˆ›å»ºé»˜è®¤ææ–™æ˜ å°„è¡¨
- æ”¯æŒå¤šç§ç¼–ç æ ¼å¼
- æä¾›å®Œæ•´çš„CRUDæ“ä½œ
- åŒ…å«åº“å­˜ç®¡ç†å’Œç»Ÿè®¡åŠŸèƒ½

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š**
- `services/material_checker.py` - éœ€è¦æ›´æ–°ä»¥ä½¿ç”¨æ–°çš„MaterialMapperç±»

### 2. é…ç½®éªŒè¯é—®é¢˜ä¿®å¤

**é—®é¢˜æè¿°ï¼š**
- é…ç½®éªŒè¯å¤±è´¥ï¼Œé…ç½®ç»“æ„ä¸åŒ¹é…
- é…ç½®ç®¡ç†å™¨æœŸæœ›æ—§çš„æ‰å¹³ç»“æ„ï¼Œä½†å®é™…config.yamlä½¿ç”¨æ–°çš„åµŒå¥—ç»“æ„

**ä¿®å¤æ–¹æ¡ˆï¼š**
å·²æ›´æ–° `utils/system_utils.py` ä¸­çš„ `validate_config` å‡½æ•°ï¼Œæ”¯æŒæ–°çš„é…ç½®ç»“æ„ï¼š

```python
def validate_config(config: Dict[str, Any]) -> Dict[str, Any]:
    """éªŒè¯é…ç½®"""
    errors = []
    warnings = []
    
    # æ£€æŸ¥å¿…éœ€é…ç½®
    required_fields = ['system']
    for field in required_fields:
        if field not in config:
            errors.append(f"ç¼ºå°‘å¿…éœ€é…ç½®å­—æ®µ: {field}")
    
    # æ£€æŸ¥ç³»ç»Ÿé…ç½®
    if 'system' in config:
        system_config = config['system']
        system_required = ['name', 'version', 'environment']
        for field in system_required:
            if field not in system_config:
                errors.append(f"ç¼ºå°‘ç³»ç»Ÿé…ç½®å­—æ®µ: system.{field}")
    
    # æ£€æŸ¥ææ–™æ˜ å°„é…ç½®
    if 'material_mapping' in config:
        material_config = config['material_mapping']
        if 'csv_path' not in material_config:
            warnings.append("ç¼ºå°‘ææ–™æ˜ å°„è¡¨è·¯å¾„é…ç½®")
    
    # æ£€æŸ¥æ–‡ä»¶ç›‘æ§é…ç½®
    if 'file_monitoring' in config:
        file_config = config['file_monitoring']
        file_required = ['onoff_file', 'macro_file']
        for field in file_required:
            if field not in file_config:
                warnings.append(f"ç¼ºå°‘æ–‡ä»¶ç›‘æ§é…ç½®: file_monitoring.{field}")
    
    # æ£€æŸ¥DNCç³»ç»Ÿé…ç½®
    if 'dnc_system' in config:
        dnc_config = config['dnc_system']
        dnc_required = ['window_title', 'process_name', 'class_name']
        for field in dnc_required:
            if field not in dnc_config:
                warnings.append(f"ç¼ºå°‘DNCç³»ç»Ÿé…ç½®: dnc_system.{field}")
    
    # æ£€æŸ¥æ•°å€¼é…ç½®
    if 'performance' in config:
        perf_config = config['performance']
        numeric_fields = ['ui_automation_timeout', 'file_monitoring_timeout', 
                         'task_scheduling_timeout', 'material_check_timeout']
        for field in numeric_fields:
            if field in perf_config and not isinstance(perf_config[field], (int, float)):
                warnings.append(f"{field} åº”è¯¥æ˜¯æ•°å­—ç±»å‹")
    
    return {
        'valid': len(errors) == 0,
        'errors': errors,
        'warnings': warnings
    }
```

### 3. é…ç½®ç®¡ç†å™¨æ›´æ–°

**éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š** `config/config_manager.py`

**éœ€è¦æ›´æ–°çš„æ–¹æ³•ï¼š**

```python
def get_material_mapping_path(self) -> str:
    """è·å–ææ–™æ˜ å°„è¡¨è·¯å¾„"""
    return self.get('material_mapping.csv_path', 'config/material_mapping.csv')

def get_output_directory(self) -> str:
    """è·å–è¾“å‡ºç›®å½•"""
    return self.get('file_monitoring.macro_file', 'C:/DNC/output/macro.txt').rsplit('/', 1)[0]

def get_status_directory(self) -> str:
    """è·å–çŠ¶æ€ç›®å½•"""
    return self.get('file_monitoring.onoff_file', 'C:/DNC/status/onoff.txt').rsplit('/', 1)[0]

def get_ui_timeout(self) -> float:
    """è·å–UIè‡ªåŠ¨åŒ–è¶…æ—¶æ—¶é—´"""
    return float(self.get('performance.ui_automation_timeout', 10))

def get_ui_retry_count(self) -> int:
    """è·å–UIè‡ªåŠ¨åŒ–é‡è¯•æ¬¡æ•°"""
    return int(self.get('automation.retry_attempts', 3))

def get_low_stock_threshold(self) -> int:
    """è·å–ä½åº“å­˜é˜ˆå€¼"""
    return int(self.get('materials.low_stock_threshold', 10))

def get_critical_stock_threshold(self) -> int:
    """è·å–ä¸¥é‡åº“å­˜é˜ˆå€¼"""
    return int(self.get('materials.critical_stock_threshold', 5))

def get_max_concurrent_tasks(self) -> int:
    """è·å–æœ€å¤§å¹¶å‘ä»»åŠ¡æ•°"""
    return int(self.get('automation.max_workers', 5))

def get_priority_levels(self) -> list:
    """è·å–ä¼˜å…ˆçº§çº§åˆ«"""
    return self.get('tasks.priority_levels', ['Normal', 'High', 'Urgent'])
```

**éœ€è¦æ›´æ–°çš„é…ç½®æ‘˜è¦æ–¹æ³•ï¼š**

```python
def print_config_summary(self) -> None:
    """æ‰“å°é…ç½®æ‘˜è¦"""
    print("\nğŸ“‹ é…ç½®æ‘˜è¦:")
    print(f"  ç³»ç»Ÿåç§°: {self.get('system.name')}")
    print(f"  ç‰ˆæœ¬: {self.get('system.version')}")
    print(f"  ç¯å¢ƒ: {self.get('system.environment')}")
    print(f"  ææ–™æ˜ å°„è¡¨: {self.get_material_mapping_path()}")
    print(f"  è¾“å‡ºç›®å½•: {self.get_output_directory()}")
    print(f"  çŠ¶æ€ç›®å½•: {self.get_status_directory()}")
    print(f"  æœ€å¤§å¹¶å‘ä»»åŠ¡: {self.get_max_concurrent_tasks()}")
    print(f"  UIè¶…æ—¶: {self.get_ui_timeout()}ç§’")
    print(f"  UIé‡è¯•æ¬¡æ•°: {self.get_ui_retry_count()}")
    print(f"  ä½åº“å­˜é˜ˆå€¼: {self.get_low_stock_threshold()}")
    print(f"  ä¸¥é‡åº“å­˜é˜ˆå€¼: {self.get_critical_stock_threshold()}")
```

### 4. æ–‡ä»¶ç›‘æ§è·¯å¾„é—®é¢˜

**é—®é¢˜æè¿°ï¼š**
- å¼€å…³æ–‡ä»¶å­˜åœ¨ï¼šFalse (C:/DNC/status/onoff.txt)
- å®æ–‡ä»¶å­˜åœ¨ï¼šFalse (C:/DNC/output/macro.txt)

**ä¿®å¤æ–¹æ¡ˆï¼š**
æ ¹æ®config.yamlä¸­çš„é…ç½®ï¼Œå®é™…è·¯å¾„åº”ä¸ºï¼š
- å¼€å…³æ–‡ä»¶ï¼šC:/macro/onoff.txt
- å®æ–‡ä»¶ï¼šC:/macro/macro.txt

éœ€è¦æ›´æ–°æ–‡ä»¶ç›‘æ§æœåŠ¡ä»¥ä½¿ç”¨æ­£ç¡®çš„è·¯å¾„ã€‚

## ä¸‹ä¸€æ­¥æ“ä½œ

1. æŒ‰ç…§ä¸Šè¿°ä¿®æ”¹æç¤ºæ›´æ–° `config/config_manager.py` æ–‡ä»¶
2. æ›´æ–°ææ–™æ£€æŸ¥å™¨ä»¥ä½¿ç”¨æ–°çš„MaterialMapperç±»
3. æ›´æ–°æ–‡ä»¶ç›‘æ§æœåŠ¡ä»¥ä½¿ç”¨æ­£ç¡®çš„æ–‡ä»¶è·¯å¾„
4. é‡æ–°è¿è¡Œæµ‹è¯•éªŒè¯ä¿®å¤æ•ˆæœ

## é¢„æœŸç»“æœ

ä¿®å¤å®Œæˆåï¼Œç³»ç»Ÿæµ‹è¯•åº”è¯¥èƒ½å¤Ÿï¼š
- âœ… æˆåŠŸåŠ è½½ææ–™æ˜ å°„è¡¨
- âœ… æ­£ç¡®éªŒè¯é…ç½®
- âœ… æ‰¾åˆ°æµ‹è¯•ææ–™
- âœ… æ–‡ä»¶ç›‘æ§æ­£å¸¸å·¥ä½œ
- âœ… ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ
