# 任务状态更新与设备分配说明

## 一、任务创建后的状态流转

当用户创建一个新任务后，任务会经历以下状态变化：

1. **Pending（待处理）**：
   - 任务刚创建时的初始状态
   - 任务被放入待处理队列中等待调度

2. **Ready（就绪）**：
   - 任务调度器根据调度策略为任务分配合适的设备
   - 任务被移动到运行中任务列表
   - [assigned_machine](file:///D:/Users/00596/Desktop/%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86%E4%B8%8B%E5%8F%91DNC/models/production_task.py#L46-L46)字段被设置为分配的设备ID

3. **Running（运行中）**：
   - 任务执行器开始执行任务
   - 任务实际在设备上运行加工

4. **Completed（已完成）**：
   - 任务成功执行完成
   - 任务被移动到已完成任务列表

## 二、任务分配机制

### 1. 调度策略
系统支持多种调度策略，默认使用材料优先策略：
- **材料优先**：优先分配材料匹配度高的任务
- **优先级优先**：优先分配高优先级任务
- **负载均衡**：平衡各设备的负载
- **效率优先**：根据综合效率评分分配任务

### 2. 分配流程
1. 系统按配置的时间间隔（默认10秒）执行调度检查
2. 检查当前可用的设备列表
3. 根据当前策略对任务进行排序和设备匹配
4. 为任务分配最佳匹配的设备
5. 更新任务状态为"Ready"并设置[assigned_machine](file:///D:/Users/00596/Desktop/%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86%E4%B8%8B%E5%8F%91DNC/models/production_task.py#L46-L46)字段

## 三、用户如何观察任务状态和设备分配

### 1. 查看任务列表
用户可以通过以下方式查看任务状态和分配的设备：

- **任务ID**：系统生成的唯一标识符
- **状态**：当前任务所处的状态（Pending/Ready/Running/Completed/Error等）
- **分配设备**：任务被分配到的设备ID（在Ready状态后会显示）

### 2. 状态更新时机
- 任务创建后立即进入Pending状态
- 调度器运行时（默认每10秒）检查并分配任务到设备，状态更新为Ready
- 任务执行器开始执行任务时，状态更新为Running
- 任务执行完成后，状态更新为Completed

### 3. 实时性说明
- 任务状态更新是实时的，状态变化会立即反映在任务对象中
- 任务列表的刷新依赖于用户界面或API调用的频率
- 系统日志会记录所有的状态变化和分配过程

## 四、典型使用场景

### 场景1：用户创建新任务
1. 用户通过界面或API创建任务
2. 系统生成任务对象，状态为Pending
3. 用户在任务列表中可以看到新任务，状态为"Pending"，设备分配为空

### 场景2：任务被分配到设备
1. 调度器运行并为任务找到合适的设备
2. 任务状态从"Pending"更新为"Ready"
3. [assigned_machine](file:///D:/Users/00596/Desktop/%E8%AE%A2%E5%8D%95%E7%AE%A1%E7%90%86%E4%B8%8B%E5%8F%91DNC/models/production_task.py#L46-L46)字段被设置为设备ID
4. 用户在任务列表中可以看到任务状态为"Ready"，并显示分配的设备ID

### 场景3：任务开始执行
1. 任务执行器开始执行任务
2. 任务状态从"Ready"更新为"Running"
3. 用户在任务列表中可以看到任务状态为"Running"

### 场景4：任务执行完成
1. 任务执行完成
2. 任务状态从"Running"更新为"Completed"
3. 用户在任务列表中可以看到任务状态为"Completed"