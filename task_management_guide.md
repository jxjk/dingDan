# 任务管理系统用户说明文档

## 一、任务创建与分配流程

### 1. 任务创建流程

1. 用户通过系统界面或API接口提交新任务信息，包括：
   - 指示书编号(instruction_id)
   - 产品型号(product_model)
   - 材料规格(material_spec)
   - 订单数量(order_quantity)
   - 任务优先级(priority)

2. 系统创建ProductionTask对象，自动分配唯一任务ID，并记录创建时间(create_time)

3. 新任务被添加到任务调度器的待处理任务队列中

### 2. 任务分配与下达逻辑

系统采用智能调度算法，定期检查并分配任务：

1. **调度触发**：系统按配置的时间间隔（默认10秒）执行调度检查

2. **可用机床检查**：系统首先检查当前可用的机床列表，机床状态为"OFF"、"IDLE"、"STANDBY"或"READY"时视为可用

3. **调度策略**：系统支持多种调度策略，默认使用材料优先策略：
   - **材料优先**：优先分配材料匹配度高的任务
   - **优先级优先**：优先分配高优先级任务
   - **负载均衡**：平衡各机床的负载
   - **效率优先**：根据综合效率评分分配任务

4. **任务分配过程**：
   - 根据当前策略对任务进行排序
   - 为每个任务寻找最佳匹配机床
   - 进行材料兼容性检查
   - 计算分配得分或效率评分
   - 将任务分配给最合适的机床

5. **状态更新**：
   - 任务状态从"PENDING"(待处理)更新为"READY"(就绪)
   - 任务被移动到运行中任务列表
   - 机床状态更新，标记当前任务

## 二、任务列表功能说明

### 1. 显示字段

- **任务ID**(task_id)：系统生成的唯一标识符
- **指示书编号**(instruction_id)：用户输入的指示书编号
- **产品型号**(product_model)：产品型号信息
- **材料规格**(material_spec)：所需材料规格
- **订单数量**(order_quantity)：订单总数量
- **优先级**(priority)：任务优先级(High/Normal/Urgent)
- **状态**(status)：任务当前状态
- **创建时间**(create_time)：任务创建的时间
- **分配机床**(assigned_machine)：分配的机床ID

### 2. 任务状态说明

- **Pending**：任务已创建，等待调度分配
- **Ready**：任务已分配给机床，等待执行
- **Running**：任务正在执行中
- **Completed**：任务已完成
- **Error**：任务执行出错
- **Paused**：任务已暂停
- **WaitingForMaterial**：等待材料更换

## 三、使用建议

1. **任务创建**：创建任务时请确保材料规格准确，以便系统进行正确的材料兼容性检查

2. **优先级设置**：紧急订单请设置为"Urgent"优先级，重要订单设置为"High"，一般订单使用"Normal"

3. **任务监控**：定期查看任务列表，关注任务状态变化和执行情况

4. **调度策略**：根据实际生产需求选择合适的调度策略：
   - 材料更换频繁时使用材料优先策略
   - 有紧急订单时使用优先级优先策略
   - 多台机床负载不均时使用负载均衡策略
   - 追求整体效率时使用效率优先策略